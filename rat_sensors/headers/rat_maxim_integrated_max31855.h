// ----------------------------------------------------------------------------------------------------
// Except when otherwise noted, this file is licensed under
// Creative Commons Attributions ShakeAlike 4.0 License (CC-BY-SA 4.0)
//
// https://creativecommons.org/licenses/by-sa/4.0/legalcode
//
// Copyright (c) 2021 - 2023 Rapiot Open Hardware Project
//
// Known limitations :
//
//   There are no known limitations.
//
// Known issues :
//
//   There are no known issues.
// ----------------------------------------------------------------------------------------------------

// ----------------------------------------------------------------------------------------------------
// Maxim Integrated MAX31855 Header File
// ----------------------------------------------------------------------------------------------------

// ----------------------------------------------------------------------------------------------------
// Includes
// ----------------------------------------------------------------------------------------------------


// ----------------------------------------------------------------------------------------------------
// Conditional compilation
// ----------------------------------------------------------------------------------------------------
#ifdef APP_THERMOCOUPLE_SENSOR

// ----------------------------------------------------------------------------------------------------
// Includes
// ----------------------------------------------------------------------------------------------------
#include <stdint.h>

// ----------------------------------------------------------------------------------------------------
// Defines
// ----------------------------------------------------------------------------------------------------

// ----------------------------------------------------------------------------------------------------
// Minimums and maximums
// ----------------------------------------------------------------------------------------------------
#define RAT_THERMOCOUPLE_SENSOR_TEMPERATURE_MINIMUM -270
#define RAT_THERMOCOUPLE_SENSOR_TEMPERATURE_MAXIMUM 1800


// ----------------------------------------------------------------------------------------------------
// Delays
// ----------------------------------------------------------------------------------------------------
#define RAT_THERMOCOUPLE_SENSOR_STABILIZATION_DELAY 1000   // 1,000 ms
#define RAT_THERMOCOUPLE_SENSOR_RESET_DELAY 1000           // 1,000 ms
#define RAT_THERMOCOUPLE_SENSOR_CHIP_SELECT_DELAY 100      //   100 ms

// ----------------------------------------------------------------------------------------------------
// Typedefs
// ----------------------------------------------------------------------------------------------------
typedef enum rat_thermocouple_sensor_data_types {RAT_THERMOCOUPLE_SENSOR_THERMOCOUPLE_TEMPERATURE_DATA,
                                                 RAT_THERMOCOUPLE_SENSOR_INTERNAL_TEMPERATURE_DATA} rat_thermocouple_sensor_data_type;

// ----------------------------------------------------------------------------------------------------
// Pin names, types, and directions
// ----------------------------------------------------------------------------------------------------

// ----------------------------------------------------------------------------------------------------
// Power
// ----------------------------------------------------------------------------------------------------
sbit RAT_THERMOCOUPLE_SENSOR_PWR_PIN at LATC.B2;
sbit RAT_THERMOCOUPLE_SENSOR_PWR_DIR at TRISC.B2;
sbit RAT_THERMOCOUPLE_SENSOR_PWR_TYP at ANSELC.B2;

// ----------------------------------------------------------------------------------------------------
// Chip select
// ----------------------------------------------------------------------------------------------------
sbit RAT_THERMOCOUPLE_SENSOR_CSL_PIN at LATA.B5;
sbit RAT_THERMOCOUPLE_SENSOR_CSL_DIR at TRISA.B5;
sbit RAT_THERMOCOUPLE_SENSOR_CSL_TYP at ANSELA.B5;

// ----------------------------------------------------------------------------------------------------
// Functions
// ----------------------------------------------------------------------------------------------------

// ----------------------------------------------------------------------------------------------------
// Init
// ----------------------------------------------------------------------------------------------------
void rat_thermocouple_sensor_init (void);

// ----------------------------------------------------------------------------------------------------
// Measure the temperature
// ----------------------------------------------------------------------------------------------------
void rat_thermocouple_sensor_measure (float   * thermocouple_temperature,
                                      float   * internal_temperature,
                                      uint8_t * fault_flag,
                                      uint8_t * short_vcc_flag,
                                      uint8_t * short_gnd_flag,
                                      uint8_t * open_circuit_flag);

#endif